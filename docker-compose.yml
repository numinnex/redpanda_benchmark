version: '3.8'
services:
  kafka:
    image: bitnami/kafka:latest
    container_name: kafka
    environment:
      # Enable both broker and controller roles
      - KAFKA_CFG_PROCESS_ROLES=broker,controller
      # Unique node ID for this broker/controller
      - KAFKA_CFG_NODE_ID=1
      # Define the quorum for controller election (for a single node, it’s just this node)
      - KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=1@kafka:9093
      # Define listeners: one for client connections and one for controller communications
      - KAFKA_CFG_LISTENERS=PLAINTEXT://:19092,CONTROLLER://:9093
       # **Specify the controller listener name**
      - KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER
      # Advertise the broker’s address for clients
      - KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://localhost:19092
      # Allow plaintext connections (for testing purposes)
      - ALLOW_PLAINTEXT_LISTENER=yes

       # --- fsync / flushing configuration ---
      # Flush log data after every message (this triggers an fsync call more often)
      - KAFKA_CFG_LOG_FLUSH_INTERVAL_MESSAGES=10000
      # Additionally, flush at least every 1000 ms
      - KAFKA_CFG_LOG_FLUSH_INTERVAL_MS=1000

      # --- Caching / Index configuration ---
      # Fine-tune log index interval (Kafka relies on the OS page cache for data caching)
      - KAFKA_CFG_LOG_INDEX_INTERVAL_BYTES=1048576
    ports:
      - "19092:19092"
      - "9093:9093"
